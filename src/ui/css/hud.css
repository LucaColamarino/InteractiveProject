/* HUD — coerente con Design System + StartMenu */
/* Dipendenze: design-system.css, startMenu.css */

/* ========== Reset & Canvas ========== */
html, body {
  margin: 0; padding: 0; overflow: hidden;
  height: 100%; width: 100%;
  font-family: var(--font-primary); background: #000;
}
canvas { display: block; position: fixed; inset: 0; z-index: var(--z-background); }

/* ========== Layering ========== */
/* sm-backdrop/ornaments già in startMenu.css: qui solo z-order coerenti */
.sm-backdrop, .sm-corner-ornaments { z-index: calc(var(--z-background) + 1); }
#hud-overlay { position: fixed; inset: 0; pointer-events: none; z-index: var(--z-hud); }

/* ========== Prompts ========== */
.interaction-wrap {
  position: absolute; top: var(--space-xl); left: 50%; transform: translateX(-50%);
  pointer-events: none; z-index: calc(var(--z-hud) + 1);
}
.interaction-prompt {
  display: inline-flex; align-items: center; gap: var(--space-md);
  padding: var(--space-md) var(--space-lg); border-radius: var(--radius-md);
  border-left: 4px solid var(--accent-green);
  background: linear-gradient(135deg, rgba(20,40,20,0.95), rgba(30,50,30,0.9));
  color: var(--text-primary); box-shadow: var(--shadow-md), 0 0 20px rgba(46,213,115,0.2);
  font-family: var(--font-display); font-weight: var(--font-weight-bold); letter-spacing: .5px;
  backdrop-filter: blur(10px); animation: slideInPrompt var(--timing-normal) var(--ease-out-quart);
  position: relative; overflow: hidden; pointer-events: none;
}
.interaction-prompt[hidden]{ display:none; }
.interaction-prompt::before {
  content:''; position:absolute; inset:0;
  background: linear-gradient(90deg, transparent, rgba(46,213,115,0.1), transparent);
  animation: shimmerPrompt 2s infinite; pointer-events:none;
}
#interaction-key {
  display:inline-flex; align-items:center; justify-content:center;
  min-width:28px; height:28px; padding: var(--space-sm) var(--space-md);
  border-radius: var(--radius-sm); background: var(--surface-dark);
  border:1px solid var(--primary-blue); color: var(--primary-blue);
  box-shadow: var(--glow-inset); font-family: var(--font-display);
  font-weight: var(--font-weight-bold); font-size: var(--font-size-sm);
}
#interaction-text { font-weight: var(--font-weight-bold); font-size: var(--font-size-md); }

/* ========== Minimap ========== */
.minimap-wrap {
  position: fixed; top: var(--space-xl); right: var(--space-xl);
  width: 220px; height: 220px; animation: slideInRight var(--timing-slow) var(--ease-out-quart);
}
.hud-minimap {
  position: absolute; inset: 0; width: 200px; height: 200px;
  border-radius: var(--radius-full); border: 3px solid var(--primary-blue);
  box-shadow: var(--shadow-lg), var(--glow-strong);
  background: radial-gradient(circle at 50% 45%, rgba(8,14,22,0.95) 0%, rgba(8,14,22,0.95) 55%, rgba(4,8,14,0.98) 100%);
  backdrop-filter: blur(6px); overflow: hidden;
}
.minimap-viewport, .minimap-grid { background: transparent; }
.minimap-hud {
  position: absolute; right: var(--space-sm); bottom: -150px; display: flex; flex-direction: column;
  gap: var(--space-sm); pointer-events: none; z-index: 1;
}
.pill {
  background: var(--surface-dark); border:1px solid rgba(100,200,255,0.4);
  border-radius: var(--radius-md); padding: var(--space-sm) var(--space-md);
  font-family: var(--font-display); font-weight: var(--font-weight-bold); font-size: var(--font-size-sm);
  color: var(--primary-blue); box-shadow: var(--glow-subtle); backdrop-filter: blur(8px);
  min-width:110px; text-align:right; transition: all var(--timing-fast) ease; position:relative; overflow:hidden;
}
.pill::before { content:''; position:absolute; inset:0; background: var(--dna-gradient); opacity: .08; pointer-events:none; }
.pill:hover { border-color: var(--primary-blue); box-shadow: var(--glow-normal); transform: translateY(-1px); }

.compass { position:absolute; top:15px; left:50%; transform:translateX(-50%); width:32px; height:32px;
  display:flex; align-items:center; justify-content:center; color:#d9ecff; font-family:var(--font-display);
  font-weight:800; font-size:var(--font-size-lg); text-shadow:0 0 6px rgba(0,0,0,.9), 0 0 8px rgba(100,200,255,.6); }

.minimap-grid { position:absolute; top:50%; left:50%; transform:translate(-50%,-50%);
  width:180px; height:180px; border-radius: var(--radius-full); overflow:hidden; }

.minimap-heading {
  position:absolute; left:50%; top:50%; width:16px; height:24px;
  background: linear-gradient(180deg, #bfe6ff, #64c8ff);
  clip-path: polygon(50% 0%, 85% 100%, 50% 76%, 15% 100%);
  border-radius:2px; filter: drop-shadow(0 0 6px rgba(100,200,255,.9));
  transform: translate(-50%, -60%); transform-origin: 50% 80%; pointer-events:none; z-index:3; box-shadow: var(--glow-subtle);
}
.minimap-player {
  position:absolute; top:50%; left:50%; transform:translate(-50%, -50%);
  width:10px; height:10px; background:#fff; border-radius: var(--radius-full);
  box-shadow: 0 0 10px rgba(100,200,255,.9), 0 0 2px #000 inset; animation: pulse 2s infinite;
}
.minimap-enemy {
  position:absolute; width:8px; height:8px; background:#ff3b57; border:2px solid #fff; border-radius:50%;
  box-shadow: 0 0 10px rgba(255,59,87,.95), 0 0 2px rgba(0,0,0,.9) inset; animation: enemyPulse 1.2s infinite ease-in-out;
}

/* ========== Vitals ========== */
.hud-vitals {
  position:absolute; bottom: var(--space-xl); left:50%; transform:translateX(-50%);
  display:flex; gap: var(--space-xxl); animation: slideInBottom var(--timing-very-slow) var(--ease-out-quart);
}
.hud-label { color: var(--text-primary); font-size: var(--font-size-md); font-weight: var(--font-weight-medium);
  margin-bottom: var(--space-sm); text-shadow: 0 1px 3px rgba(0,0,0,.7); display:flex; align-items:center; gap: var(--space-sm); }

.progress-container {
  background: var(--surface-dark); border:1px solid rgba(100,200,255,.3); border-radius:25px;
  height: var(--progress-height); width: var(--progress-width); overflow:hidden; position:relative;
  box-shadow: var(--shadow-inset); backdrop-filter: blur(4px);
}
.progress-container:hover .progress-bar { filter: brightness(1.1); }

.progress-bar {
  height:100%; border-radius:25px; position:relative; overflow:hidden;
  transition: width var(--timing-normal) var(--ease-out-quart), box-shadow var(--timing-normal) ease;
}
.progress-bar::before {
  content:''; position:absolute; top:0; left:-100%; width:100%; height:100%;
  background: linear-gradient(90deg, transparent, rgba(255,255,255,.25), transparent);
  animation: shimmerLine 3s infinite;
}
.progress-bar::after { content:''; position:absolute; inset:0; background: var(--dna-gradient); opacity:.1; animation: dnaFlow 4s linear infinite; }

.health-bar  { background: linear-gradient(135deg, var(--danger-red), var(--danger-red-light)); box-shadow: 0 0 15px rgba(255,71,87,.4); }
.mana-bar    { background: linear-gradient(135deg, var(--mana-blue), var(--mana-blue-light)); box-shadow: 0 0 15px rgba(55,66,250,.4); }
.stamina-bar { background: linear-gradient(135deg, var(--accent-green), var(--accent-green-light)); box-shadow: 0 0 15px rgba(46,213,115,.4); }
.xp-bar      { background: linear-gradient(135deg, var(--warning-orange-light), var(--warning-orange)); box-shadow: 0 0 15px rgba(241,196,15,.4); }
.xp-bar.levelup { animation: levelFlash var(--timing-slow) ease-out; }

.progress-text {
  position:absolute; top:50%; left:50%; transform:translate(-50%, -50%); color: var(--text-inverse);
  font-weight: var(--font-weight-bold); font-size: var(--font-size-sm); font-family: var(--font-display);
  text-shadow:1px 1px 2px rgba(0,0,0,.8); z-index:2; letter-spacing:.5px;
}

/* ========== Notifications ========== */
.notification-area {
  position:absolute; top:25%; left: var(--space-xxl); transform: translateY(-50%);
  display:flex; flex-direction:column; gap: var(--space-md); max-width:320px; z-index: calc(var(--z-hud) + 1);
}
.notification {
  background: linear-gradient(135deg, rgba(20,40,20,.95), rgba(30,50,30,.9));
  border-left:4px solid var(--accent-green); border-radius: var(--radius-md);
  padding: var(--space-lg); color: var(--text-primary);
  box-shadow: var(--shadow-md), 0 0 20px rgba(46,213,115,.2);
  backdrop-filter: blur(10px); font-family: var(--font-primary); font-weight: var(--font-weight-medium);
  font-size: var(--font-size-md); transform: translateX(-100%);
  animation: slideInNotification var(--timing-normal) var(--ease-out-quart) forwards;
  position:relative; overflow:hidden;
}
.notification::before { content:''; position:absolute; inset:0; background: var(--hex-pattern); opacity:.05; }
.notification::after  { content:''; position:absolute; top:0; left:-100%; width:100%; height:100%;
  background: linear-gradient(90deg, transparent, rgba(46,213,115,.1), transparent);
  animation: shimmerNotification 2s infinite; }

/* ========== Action keys ========== */
.action-keys {
  position:absolute; bottom: var(--space-xl); left: var(--space-xl);
  display:flex; flex-direction:column; gap: var(--space-md); z-index: calc(var(--z-hud) + 1);
}
.action-key {
  display:flex; align-items:center; gap: var(--space-md); padding: var(--space-sm) var(--space-md);
  border-radius: var(--radius-md); background: rgba(10,20,30,.85);
  border:1px solid var(--primary-blue); box-shadow: var(--shadow-md), var(--glow-subtle); backdrop-filter: blur(6px);
}
.key-label {
  display:inline-flex; align-items:center; justify-content:center; min-width:32px; height:32px;
  font-family: var(--font-display); font-weight: var(--font-weight-bold); font-size: var(--font-size-sm);
  color: var(--primary-blue); background: var(--surface-dark);
  border:1px solid var(--primary-blue); border-radius: var(--radius-sm); box-shadow: var(--glow-inset);
}
.key-action { font-family: var(--font-primary); font-size: var(--font-size-sm); color: var(--text-primary); font-weight: var(--font-weight-medium); }

/* ========== Loading (coerente) ========== */
/* ========== Loading — StartMenu style (ember) ========== */
#loading-screen{
  position:fixed; inset:0;
  background: radial-gradient(1200px 700px at 50% 60%, rgba(8,10,16,0.92), rgba(5,7,12,0.98) 60%, #05070C 100%),
              linear-gradient(180deg, #0a0f19 0%, #070b12 100%);
  display:flex; flex-direction:column; align-items:center; justify-content:center;
  z-index:99999; transition:opacity .5s ease;
}
#loading-screen.hidden{ opacity:0; pointer-events:none; }

.loading-logo{
  font-family: var(--font-display, 'Orbitron', system-ui);
  font-size: clamp(2.2rem, 3.2vw, 3.6rem);
  font-weight: 900;
  letter-spacing: .12em;
  background: linear-gradient(180deg, #ffd7a6 0%, #ffb14a 45%, #ff7a1a 100%);
  -webkit-background-clip: text; background-clip: text;
  -webkit-text-fill-color: transparent;
  filter: drop-shadow(0 0 20px rgba(255,155,60,.25));
  text-shadow: 0 0 30px rgba(255,180,90,.18);
  margin-bottom: 2rem;
  animation: smTitlePulse 2.4s ease-in-out infinite;
}

/* piastra + scanalatura con bordo “bruciato” */
.sm-loader-plate{
  width: min(640px, 78vw);
  padding: 14px;
  border-radius: 14px;
  background:
    radial-gradient(120% 160% at 50% 0%, rgba(255,155,60,.14), transparent 55%),
    linear-gradient(180deg, rgba(25,15,8,.6), rgba(12,8,6,.6));
  box-shadow:
    inset 0 1px 0 rgba(255,205,120,.12),
    0 16px 40px rgba(0,0,0,.65),
    0 0 80px rgba(255,120,40,.08);
  border: 1px solid rgba(255,180,90,.18);
  backdrop-filter: blur(4px);
}
.sm-loader-groove{
  position:relative;
  height: 14px;
  border-radius: 999px;
  background: linear-gradient(180deg, #1a120c, #0e0a07);
  box-shadow:
    inset 0 2px 6px rgba(0,0,0,.85),
    inset 0 0 0 1px rgba(255,155,60,.10);
  overflow:hidden;
}

/* la “fill” usa bagliori arancio + venature incandescenti */
.sm-loader-fill{
  position:absolute; top:0; left:0; height:100%; width:0%;
  background:
    linear-gradient(90deg, rgba(255,180,90,.0) 0%, rgba(255,210,150,.25) 20%, rgba(255,180,90,.0) 40%) 0 0 / 240px 100% repeat-x,
    linear-gradient(180deg, #ff861d 0%, #ff6b1a 40%, #ff5b15 100%);
  box-shadow:
    0 0 10px rgba(255,120,40,.45),
    0 0 22px rgba(255,140,60,.35),
    0 0 50px rgba(255,120,40,.22);
  animation: smEmberFlow 2.2s linear infinite;
  will-change: background-position, width;
}

/* particelle incandescenti sopra la barra */
.sm-loader-embers{
  pointer-events:none;
  position:absolute; inset:0;
  background:
    radial-gradient(6px 6px at 10% 50%, rgba(255,160,70,.65), transparent 70%),
    radial-gradient(5px 5px at 30% 40%, rgba(255,120,40,.6), transparent 70%),
    radial-gradient(4px 4px at 55% 60%, rgba(255,200,120,.55), transparent 70%),
    radial-gradient(6px 6px at 72% 45%, rgba(255,150,60,.6), transparent 70%),
    radial-gradient(5px 5px at 88% 55%, rgba(255,110,30,.55), transparent 70%);
  opacity:.75;
  mix-blend-mode: screen;
  animation: smCinders 3s linear infinite;
}

.loading-message{
  color: rgba(255,210,150,.85);
  margin-top: 1.2rem;
  font-family: var(--font-display, 'Orbitron', system-ui);
  font-size: .95rem;
  letter-spacing: .06em;
  text-shadow: 0 0 12px rgba(255,140,60,.22);
  min-height: 1.2rem;
  text-align: center;
}
.loading-percent{
  color: rgba(255,225,180,.9);
  margin-top: .25rem;
  font-family: var(--font-display, 'Orbitron', system-ui);
  font-weight: 800;
  letter-spacing: .08em;
  font-size: .9rem;
  opacity: .85;
  text-shadow: 0 0 14px rgba(255,140,60,.2);
}

/* animazioni */
@keyframes smEmberFlow{
  0%{ background-position: 0 0, 0 0; }
  100%{ background-position: 240px 0, 0 0; }
}
@keyframes smCinders{
  0%{ filter: brightness(1) blur(0px); opacity:.75; }
  50%{ filter: brightness(1.25) blur(.2px); opacity:.95; }
  100%{ filter: brightness(1) blur(0px); opacity:.75; }
}
@keyframes smTitlePulse{
  0%{ text-shadow: 0 0 14px rgba(255,150,70,.18), 0 0 0 rgba(0,0,0,0); }
  50%{ text-shadow: 0 0 28px rgba(255,160,80,.28), 0 0 80px rgba(255,120,40,.08); }
  100%{ text-shadow: 0 0 14px rgba(255,150,70,.18), 0 0 0 rgba(0,0,0,0); }
}

/* ========== Animations (no duplicati) ========== */
@keyframes slideInRight { from{transform:translateX(100%);opacity:0;} to{transform:translateX(0);opacity:1;} }
@keyframes slideInBottom { from{transform:translate(-50%,100%);opacity:0;} to{transform:translate(-50%,0);opacity:1;} }
@keyframes slideInNotification { to{ transform: translateX(0); } }
@keyframes slideInPrompt { from{transform:translate(-50%,-10px);opacity:0;} to{transform:translate(-50%,0);opacity:1;} }
@keyframes pulse { 0%,100%{ transform:translate(-50%,-50%) scale(1); box-shadow: var(--glow-normal); } 50%{ transform:translate(-50%,-50%) scale(1.3); box-shadow: var(--glow-strong);} }
@keyframes enemyPulse { 0%,100%{opacity:0.8; transform:scale(1);} 50%{opacity:1; transform:scale(1.2);} }
@keyframes shimmerPrompt { 0%{left:-100%;} 50%{left:100%;} 51%{left:-100%;} 100%{left:-100%;} }
@keyframes shimmerNotification { 0%{left:-100%;} 100%{left:100%;} }
@keyframes dnaFlow { 0%{background-position:0 0;} 100%{background-position:20px 20px;} }
@keyframes levelFlash { 0%{box-shadow:0 0 15px rgba(241,196,15,.4); transform:scale(1);} 50%{box-shadow:0 0 35px rgba(241,196,15,.8); transform:scale(1.05);} 100%{box-shadow:0 0 15px rgba(241,196,15,.4); transform:scale(1);} }
/* progress shimmer (linea) */
@keyframes shimmerLine { 0%{left:-100%;} 100%{left:100%;} }
/* loading shimmer */
@keyframes shimmerStripe { 0% { background-position: -200% 0; } 100% { background-position: 200% 0; } }
/* titolo glow */
@keyframes titleGlow { from{ text-shadow:0 0 10px rgba(100,200,255,.2);} to{ text-shadow:0 0 30px rgba(100,200,255,.4);} }

/* ========== Responsive ========== */
@media (max-width: 1200px) {
  .hud-minimap { width: 160px; height: 160px; }
  .minimap-wrap { width: 180px; height: 180px; }
  .progress-container { width: var(--progress-width-sm); }
  .hud-vitals { gap: var(--space-lg); }
  .notification-area { max-width: 280px; left: var(--space-lg); }
}
@media (max-width: 768px) {
  .hud-vitals { flex-direction: column; align-items: center; gap: var(--space-md); }
  .minimap-wrap { top: var(--space-lg); right: var(--space-lg); width: 140px; height: 140px; }
  .hud-minimap { width: 140px; height: 140px; }
  .pill { font-size: var(--font-size-xs); padding: var(--space-xs) var(--space-sm); min-width: 80px; }
  .interaction-wrap { top: var(--space-lg); }
  .notification-area { left: var(--space-md); max-width: calc(100vw - var(--space-xl)); }
}
#loading-screen.hidden ~ .sm-backdrop,
#loading-screen.hidden ~ .sm-corner-ornaments {
  opacity: 0;
  filter: blur(2px);
  transition: opacity .45s ease, filter .45s ease;
}